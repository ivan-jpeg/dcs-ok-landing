# Задача: утилита измерения максимальной перегрузки при посадке в DCS

Реализовать утилиту для симулятора Digital Combat Simulator (DCS), которая измеряет максимальную вертикальную перегрузку при посадке (касании земли) самолёта игрока.

---

## Окружение

Утилита должна работать как **исполняемый Lua-скрипт** в окружении DCS (не мод и не плагин — именно скрипт, выполняемый в среде симулятора). Использовать DCS Scripting API.

---

## Бизнес-логика

### Начало измерения

#### Запуск через радио-меню
В **радио-меню** в разделе **Other** есть пункт меню **Старт измерения**. При выборе этого пункта выводится **стандартное текстовое сообщение DCS** (вывод через API сообщений, например `trigger.action.outTextForGroup`), в котором отображаются **текущая и максимальная вертикальная перегрузка с момента включения измерения** (ручной «Старт» или автозапуск при снижении ниже 100 м).

Текстовое содержимое сообщения — **две строки** (точно в таком виде):

```
Ny = 0.00
Ny(max) = 0.00
```

- **Ny** — текущее значение перегрузки по оси Y самолёта; измеряется и выводится постоянно, пока идёт измерение.
- **Ny(max)** — максимум вертикальной перегрузки с момента включения измерения или последнего сброса.
- Формат чисел: два знака после запятой (например, 0.00, 2.35).
- Пока идёт измерение, сообщение **постоянно обновляется** (рекомендуемый интервал не реже 0,1–0,2 с), чтобы отображались актуальные Ny и Ny(max).

#### Автозапуск по высоте
Автоматически **включать** измерение, когда высота самолёта игрока **впервые становится меньше 100 м над землёй** (переход сверху вниз через порог 100 м). Порог — **100 м над землёй (AGL)**. Высота над землёй: разница между высотой единицы над уровнем моря (`Unit.getPosition().p.y`) и высотой рельефа в данной точке (`land.getHeight({x=pos.x, y=pos.z})`). При автозапуске через **радио-меню** сохраняется возможность остановить или обнулить измерение.

### Сброс измерения

В **радио-меню** в разделе **Other** есть пункт меню **«Сброс измерения»**. При выборе этого пункта:
- сбрасывается только **Ny(max)** (достигнутый максимум);
- текущее Ny продолжает считаться; накопление нового максимума идёт с этого момента.

### Конец измерения

#### Остановка через радио-меню
В **радио-меню** в разделе **Other** есть пункт меню **«Стоп измерения»**. При выборе этого пункта:
- измерение прекращается;
- сообщение скрывается (пустой текст или нулевая длительность отображения).

#### Автоостановка по высоте
При наборе высоты самолётом игрока **выше 100 м над землёй** (AGL) измерение автоматически **выключается**, все показания **сбрасываются**. Повторный заход ниже 100 м снова запускает измерение (или ручной «Старт»). Сохраняется возможность запустить и обнулить измерение через **радио-меню**.

---

## Результат

Сгенерированный Lua-скрипт сохранить в файл **`ok-landing.lua`** в директории **`ok-landing`** (относительно корня проекта). Итоговый путь: `ok-landing/ok-landing.lua`. В начале кода сделай комментарий с версией скрипта, текущая итерация 2.0.

---

## Технические заметки для исполнителя

- Код скрипта должен быть пригоден для вызова в миссии по команде **DO SCRIPT FILE**.
- Использовать **DCS Scripting API** (Mission Scripting) для:
  - радио-меню (добавление пунктов в раздел Other);
  - вывода и скрытия сообщений (показ текста, скрытие — пустое сообщение или нулевая длительность);
  - данных о перегрузке (Ny, Ny(max)).
- **Ny — перегрузка по оси Y в связанной (бортовой) системе координат самолёта**, а не по мировой вертикали. При крене 90° мировая вертикаль не совпадает с осью Y самолёта (в абсолютной системе ускорение по Y = 1g, а по оси Y самолёта Ny > 1). Учитывать это при расчёте.
- В Mission Scripting `Object.getVelocity()` возвращает скорость в **мировой** СК. Для Ny в связанной оси Y: либо использовать API, возвращающий перегрузку/ускорение в осях самолёта (если доступен в миссиях), либо вычислять ускорение из скорости и переводить его из мировой СК в связанную по ориентации единицы (`getPosition()` даёт ориентацию). `LoGetMCPState()` относится к **Export**-скриптам, не к Mission Scripting; ориентироваться на [Simulator Scripting Engine](https://wiki.hoggitworld.com/view/Simulator_Scripting_Engine_Documentation) и [Object/Unit](https://wiki.hoggitworld.com/view/Category:Class_Functions).
- **Высота над землёй (AGL):** высота единицы — `Unit.getPosition().p` (компонента `.y` — над уровнем моря); высота рельефа — [land.getHeight(vec2)](https://wiki.hoggitworld.com/view/DCS_func_getHeight). AGL = высота единицы минус высота рельефа в данной точке.
- Документация: [Simulator Scripting Engine](https://wiki.hoggitworld.com/view/Simulator_Scripting_Engine_Documentation), [Functions](https://wiki.hoggitworld.com/view/Category:Functions), [Class Functions](https://wiki.hoggitworld.com/view/Category:Class_Functions), [Singleton Functions](https://wiki.hoggitworld.com/view/Category:Singleton_Functions), [Events](https://wiki.hoggitworld.com/view/Category:Events), при необходимости [Trigger](https://wiki.hoggitworld.com/view/Category:Trigger) для сообщений и таймеров.
- Учитывать только единицу (самолёт) игрока; привязка логики к самолёту игрока обязательна. При нескольких игроках — привязка к группе каждого игрока (меню и состояние по группе).
